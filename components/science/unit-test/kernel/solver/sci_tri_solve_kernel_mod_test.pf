!-----------------------------------------------------------------------------
! Copyright (c) 2017,  Met Office, on behalf of HMSO and Queen's Printer
! For further details please refer to the file LICENCE which you
! should have received as part of this distribution.
!-----------------------------------------------------------------------------

module sci_tri_solve_kernel_mod_test

  use constants_mod, only: r_def, i_def
  use funit

  implicit none

  private
  public :: test_all

contains

  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  @test
  subroutine test_all()

    use sci_tri_solve_kernel_mod, only: tri_solve_code

    implicit none

    real(r_def) :: tol = 1.0e010_r_def

    integer(kind=i_def), parameter :: nz = 10
    integer(kind=i_def) :: map(1)
    real(kind=r_def) :: x(nz), y(nz), A0(nz), AP(nz), AM(nz)
    real(kind=r_def) :: answer(nz)
    real(kind=r_def) :: data_matrix(nz,6)
    map(1) = 1_i_def

    x      = real((/ 1, 4, 6, 2, -4, 2, 5, 8, -3, 2 /),r_def)
    answer =      (/ 0.595740342096225_r_def, &
                     1.536623742649890_r_def, &
                     1.921640812369115_r_def, &
                     0.678807366246152_r_def, &
                    -0.699910115193080_r_def, &
                     0.805771536505973_r_def, &
                     1.903359140732273_r_def, &
                     2.277107208194344_r_def, &
                    -0.248802850816906_r_def, &
                     0.456459501107042_r_def /)
    A0     =  4.0_r_def
    AP     = -0.9_r_def
    AM     = -0.7_r_def

    call tri_solve_code(nz, y, x, A0, AP, AM, 1, nz, map)

    @assertEqual( answer, y, tol )

  end subroutine test_all

end module sci_tri_solve_kernel_mod_test

