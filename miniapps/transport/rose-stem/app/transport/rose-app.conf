[command]
aprun   = aprun   -n 6 $BIN_DIR/transport transport_configuration.nml
mpiexec = mpiexec -n 6 $BIN_DIR/transport transport_configuration.nml
default = $BIN_DIR/transport transport_configuration.nml

[file:$DESTINATION_DIRECTORY]
mode=mkdir

[file:transport_configuration.nml]
source=namelist:base_mesh namelist:extrusion namelist:finite_element
      =namelist:initial_temperature
      =namelist:initial_wind namelist:output
      =namelist:subgrid namelist:initial_density namelist:transport
      =namelist:planet namelist:restart 
      =namelist:idealised namelist:formulation namelist:biperiodic_deppt
      =namelist:solver namelist:mixed_solver namelist:helmholtz_solver
      =namelist:timestepping namelist:partitioning
      =namelist:domain_size namelist:multigrid
mode=auto

[file:transport_restart.nml]
source=namelist:restart_nml
mode=auto

[namelist:base_mesh]
prime_mesh_name = 'dynamics'
fplane          = .false.
f_lat_deg       = 45.0

[namelist:domain_size]
planar_domain_min_x = -1.0
planar_domain_max_x =  1.0
planar_domain_min_y = -1.0
planar_domain_max_y =  1.0

[namelist:extrusion]
method           = 'uniform'
domain_top       = 10.0
number_of_layers = 10

[namelist:finite_element]
cellshape        = 'quadrilateral'
element_order    = 0
coordinate_order = 2
rehabilitate     = .true.
supg             = .false.
vorticity_in_w1  = .true.

[namelist:helmholtz_solver]
method                         = 'bicgstab'
preconditioner                 = 'diagonal'
si_pressure_tolerance          = 1.0e-4
si_pressure_maximum_iterations = 199
gcrk                           = 4
normalise                      = .true.

[namelist:initial_temperature]
bvf_square = 0.0001

[namelist:initial_wind]
profile        = 'solid_body_rotation'
u0             = 38.61073731
v0             = 0.0
sbr_angle_lat  = 0.25
sbr_angle_lon  = 0.0
smp_init_wind  = .false.


[namelist:mixed_solver]
si_tolerance          = 1.0e-4
si_method             = 'gmres'
si_preconditioner     = 'pressure'
si_postconditioner    = 'none'
si_maximum_iterations = 20
si_tolerance          = 1.0e-4
guess_np1             = .F
gcrk                  = 4
use_operators         = .true.
normalise             = .true.

[namelist:multigrid]
l_multigrid            = .false.
multigrid_chain_nitems = 1
ugrid                  = 'prime'

[namelist:output]
diag_stem_name            = 'transport'
write_xios_output         = .true.
write_nodal_output        = .true.
diagnostic_frequency      = 32
subroutine_timers         = .true.
subroutine_counters       = .false.

[namelist:partitioning]
auto = .true.

[namelist:planet]
radius         = 6371229.0
scaling_factor = 1.0

[namelist:subgrid]
rho_approximation                 = 'ppm_positive_monotone'
dep_pt_stencil_extent             = 1
rho_approximation_stencil_extent  = 2

[namelist:transport]
consistent_metric=.false.
enforce_monotonicity=.false.
fv_advective_order=3
fv_flux_order=2
operators='fv'
scheme='horz_cosmic'

[namelist:formulation]
transport_only=.true.

[namelist:biperiodic_deppt]
method='euler'
n_dep_pt_iterations=1

[namelist:idealised]
test='cosine_hill'

[namelist:initial_density]
tracer_max        = 1.0
tracer_background = 0.1
r1                = 0.343611696486384
x1                = 0.0
y1                = 0.0
r2                = 0.343611696486384
x2                = 0.0
y2                = 0.0

[namelist:restart]
filename = 'transport_restart.nml'

[namelist:restart_nml]
checkpoint_read      = .false.
timestep_start       = 1
timestep_end         = $RESTART_STOP
checkpoint_write     = .false.
restart_stem_name    = "restartTransport"
checkpoint_frequency = 9999
xios_checkpoint      = .false.

[namelist:solver]
method             = 'bicgstab'
preconditioner     = 'diagonal'
maximum_iterations = 399
tolerance          = 1.0e-12
gcrk               = 1 

[namelist:timestepping]
method             = 'semi_implicit'
dt                 = $DT
alpha              = 0.5
outer_iterations   = 2
inner_iterations   = 2
runge_kutta_method = 'ssp3'
